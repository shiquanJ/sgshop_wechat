<!--pages/order/detail/detail.wxml-->
<view class="top">
	<block wx:if="{{is_self == 'false'}}">
		<view class="addr-item" bindtap="getAddrList">
			<view class="addr-start">
				<view class="addr-box">
					<view class="flex bold">
						<image class="addr-image" src="/images/icon/location.png"></image>
						{{receipt_detail}}
					</view>
					<view class="flex p-l-35">
						<view class="small-text opa-6">
							{{receipt_name+" "+gender}}
						</view>
						<view class="small-text opa-6 p-l-35">
							{{receipt_phone}}
						</view>
					</view>
					<view class="flex space-between p-l-35">
						<view class="bold opa-8">
							{{order_state == '0' ? '配送中':'已完成'}}
						</view>
						<view class="small-text opa-8 orange-text">
							大约{{order_sendtime}}送达
						</view>
					</view>
				</view>
			</view>
			<view class="addr-end">
				<image class="addr-icon" src="/images/icon/add_left.png">
				</image>
			</view>
		</view>
	</block>
	<block wx:else>
		<view class="card" wx:if="{{order_state == 0}}">
			<view class="card-title">取餐号</view>
			<view class="card-content">
				<view class="card-info">
					<text class="card-code bold opa-8">{{order_number}}</text>
					<text class="card-info-r">美食正在制作中...</text>
				</view>
				<view class="card-coomment small-text" wx:if="{{user_comment !== ''}}">备注： {{user_comment}}</view>
				<view class="card-tips">稍等片刻，美味马上就好 (｡･ω･｡)ﾉ♡</view>
			</view>
		</view>
	</block>
</view>

<view class="order">
	<view class="order-title">订单详情</view>
	<view class="order-list">
		<!-- 输出订单商品 -->
		<view class="order-item" wx:for="{{order_detail_list}}" wx:key="id">
			<view class="order-item-l">
				<image class="order-item-image" mode="widthFix" src="{{server}}{{item.image_url}}"></image>
				<view>
					<view class="order-item-name">{{item.prd_name}}</view>
					<view class="order-item-number">x {{item.order_cnt}}</view>
				</view>
			</view>
			<view class="order-item-price">{{priceFormat(item.price)}}</view>
		</view>
		<!-- 优惠信息 -->
		<view class="order-item" wx:if="{{checkPromotion(promotion)}}">
			<view class="order-item-l">
				<text class="order-promotion-icon">减</text>满减优惠
			</view>
			<view class="order-promotion-price">- {{priceFormat(promotion)}}</view>
		</view>
		<!-- 小计 -->
		<view class="order-item">
			<view class="order-item-l">小计</view>
			<view class="order-total-price">{{priceFormat(total_price)}}</view>
		</view>
	</view>
</view>

<block wx:if="{{is_self == 'true'}}">
	<view class="list">
		<view class="list-title opa-8">
			订单号码
			<view class="list-info">{{order_id}}</view>
		</view>
		<view class="list-title opa-8">
			下单时间
			<view class="list-info">{{create_dt}}</view>
		</view>
		<view class="list-title opa-8">
			付款时间
			<view class="list-info">{{create_dt}}</view>
		</view>
	</view>
	<view class="tips" wx:if="{{order_state == '0'}}">请凭此页面至取餐台取餐~</view>
	<view class="tips" wx:else>取餐号为 {{order_number}} 的顾客,您已取餐~</view>
</block>


<wxs module="priceFormat">
	module.exports = function(price) {
		return '¥ ' + parseFloat(price)
	}
</wxs>
<!-- 检查满减信息 -->
<wxs module="checkPromotion">
	module.exports = function(promotion) {
		return parseFloat(promotion) > 0
	}
</wxs>